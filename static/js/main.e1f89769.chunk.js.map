{"version":3,"sources":["Model.jsx","parray.jsx","petmatch.jsx","App.js","serviceWorker.js","index.js"],"names":["Model","props","predict","image","a","model","mdl","crossOrigin","cvs","document","createElement","width","height","getContext","drawImage","img_t_bw","tensor_grayscale","tf","fromPixels","reshape","output","arraySync","this","x","rFactor","gFactor","bFactor","r","slice","shape","g","b","gray","mul","add","Parray","arr","fnc","mdlref","totalLoaded","loadedCount","length","embs","addEmbs","imgs","totalEmb","embCount","cback","createImg","img","src","Date","getTime","onload","map","i","getEmbs","emb","addImgs","PetMatch","mov","setState","mouseOver","mlef","dv","undefined","mainDiv","e","state","info","inputSRC","petready","inputready","bothready","className","onMouseOver","onMouseLeave","ref","FacebookShareButton","url","style","position","bottom","right","display","FacebookIcon","size","round","TwitterShareButton","TwitterIcon","String","name","alt","dist","toFixed","href","link","target","rel","Component","App","imgUploaded","inputURL","URL","createObjectURL","files","handleLoad","input_emb","inputReady","run","handleEmb","petsReady","pdata","parr","op","find_distances","pets_distances","refdata","key","push","sort","y","d3","pets","img_emb","el","emb_compares","pet_emb","pe","distance","Math","pow","zipInput","console","log","zipref","value","substr","newdat","zipdata","filter","d","searchzip","nmatch","min","getRandomSubarray","petsFound","nmatched","zip","dsty","fontWeight","type","onChange","maxLength","onMouseUp","onLoad","p","temp","index","shuffled","floor","random","Boolean","window","location","hostname","match","rawzip","require","rawdata","NaN","addKey","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.e1f89769.chunk.js","sourcesContent":["import * as tf from \"@tensorflow/tfjs\";\n\nclass Model {\n  constructor(props) {\n    this.model = tf.loadLayersModel(\"model/model.json\");\n  }\n\n  predict = async (image) => {\n    const mdl = await this.model;\n    image.crossOrigin = \"\";\n    var cvs = document.createElement(\"canvas\");\n    cvs.width = 20;\n    cvs.height = 20;\n\n    var ctx = cvs.getContext(\"2d\");\n    ctx.drawImage(image, 0, 0, 20, 20);\n\n    var img_t_bw = this.tensor_grayscale(tf.browser.fromPixels(cvs)).reshape([\n      1,\n      20,\n      20,\n      1,\n    ]);\n    var output = mdl.predict(img_t_bw).arraySync()[0];\n    return output;\n  };\n\n  tensor_grayscale(x) {\n    const rFactor = tf.scalar(0.299); // copies the values from torch\n    const gFactor = tf.scalar(0.587);\n    const bFactor = tf.scalar(0.114);\n\n    // separate out each channel. x.shape[0] and x.shape[1] will give you\n    // the correct dimensions regardless of image size\n    var r = x.slice([0, 0, 0], [x.shape[0], x.shape[1], 1]);\n    var g = x.slice([0, 0, 1], [x.shape[0], x.shape[1], 1]);\n    var b = x.slice([0, 0, 2], [x.shape[0], x.shape[1], 1]);\n\n    // add all the tensors together, as they should all be the same dimensions.\n    var gray = r.mul(rFactor).add(g.mul(gFactor)).add(b.mul(bFactor));\n    gray = gray.mul(tf.scalar(1.0 / 255.0));\n\n    return gray;\n  }\n}\n\nexport default Model;\n","class Parray {\n  constructor(arr, fnc, mdlref) {\n    this.model = mdlref;\n    this.arr = arr;\n    this.loadedCount = 0;\n    this.embCount = 0;\n    this.imgs = this.addImgs(arr);\n    this.embs = [];\n    this.cback = fnc;\n  }\n\n  addImgs(arr) {\n    return arr.map((a) => this.createImg(a));\n  }\n\n  totalLoaded = () => {\n    this.loadedCount = this.loadedCount + 1;\n    if (this.loadedCount === this.arr.length) {\n      this.embs = this.addEmbs(this.imgs);\n    }\n  };\n\n  totalEmb = () => {\n    this.embCount = this.embCount + 1;\n    if (this.embCount === this.arr.length) {\n      this.cback();\n    }\n  };\n\n  createImg = (a) => {\n    var img = document.createElement(\"img\");\n    img.crossOrigin = \"anonymous\";\n    img.src = a.src + \"?\" + new Date().getTime();\n    img.onload = this.totalLoaded;\n    return img;\n  };\n\n  addEmbs = (imgs) => {\n    return imgs.map((i) => this.getEmbs(i));\n  };\n\n  getEmbs = async (i) => {\n    var emb = await this.model.predict(i);\n    this.totalEmb();\n    return emb;\n  };\n}\n\nexport default Parray;\n","import React, { Component } from \"react\";\nimport \"./petmatch.css\";\nimport {\n  FacebookShareButton,\n  FacebookIcon,\n  TwitterShareButton,\n  TwitterIcon,\n} from \"react-share\";\n\nclass PetMatch extends Component {\n  constructor(props) {\n    super(props);\n\n    this.dv = undefined;\n    this.mainDiv = (e) => (this.dv = e);\n\n    this.state = {\n      mouseOver: false,\n    };\n  }\n\n  mov = () => {\n    this.setState({ mouseOver: true });\n  };\n\n  mlef = () => {\n    this.setState({ mouseOver: false });\n  };\n\n  render() {\n    const info = this.props.info;\n    const inputSRC = this.props.inputSRC;\n    const petready = this.props.petready;\n    const inputready = this.props.inputready;\n    const bothready = petready & inputready;\n\n    return (\n      <div\n        className={this.state.mouseOver ? \"mover\" : \"normal\"}\n        onMouseOver={this.mov}\n        onMouseLeave={this.mlef}\n        ref={this.mainDiv}\n      >\n        <FacebookShareButton\n          url=\"https://mthorrell.github.io/FacePet\"\n          style={{\n            position: \"absolute\",\n            bottom: \"5px\",\n            right: \"5px\",\n            display: petready & this.state.mouseOver ? \"\" : \"none\",\n          }}\n        >\n          <FacebookIcon size={32} round />\n        </FacebookShareButton>\n        <TwitterShareButton\n          url=\"https://mthorrell.github.io/FacePet\"\n          style={{\n            position: \"absolute\",\n            bottom: \"5px\",\n            right: \"40px\",\n            display: petready & this.state.mouseOver ? \"\" : \"none\",\n          }}\n        >\n          <TwitterIcon size={32} round />\n        </TwitterShareButton>\n        <h2 style={{ display: petready ? \"\" : \"none\" }}>{String(info.name)}</h2>\n        <span>\n          <img\n            className=\"inRow\"\n            src={inputSRC}\n            alt=\"\"\n            style={{\n              display: inputready ? \"inline\" : \"none\",\n            }}\n          />\n          <img\n            className=\"inRow\"\n            alt={petready ? info.name : \"\"}\n            crossOrigin=\"anonymous\"\n            src={info.src + \"?\" + new Date().getTime()}\n            style={{ display: petready ? \"\" : \"none\" }}\n          />\n        </span>\n\n        <div>\n          <div>\n            <span\n              style={{\n                display: bothready ? \"inline\" : \"none\",\n              }}\n            >\n              Distance: {info.dist.toFixed(2)}\n            </span>\n          </div>\n          <span>\n            {petready ? (\n              <a href={info.link} target=\"_blank\" rel=\"noopener noreferrer\">\n                {\" \"}\n                See more of {String(info.name)}\n              </a>\n            ) : (\n              \"LOADING PET\"\n            )}\n          </span>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default PetMatch;\n","import React, { Component } from \"react\";\nimport \"./App.css\";\nimport Model from \"./Model\";\nimport Parray from \"./parray.jsx\";\nimport * as d3 from \"d3\";\nimport PetMatch from \"./petmatch\";\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.emb = null;\n    this.inputReady = false;\n    this.petsReady = false;\n    this.model = new Model();\n    this.parr = new Parray(props.pdata, this.handleEmb, this.model);\n    this.refdata = props.pdata;\n    this.zipdata = props.zipdata;\n\n    this.zipref = undefined;\n    this.zip = (e) => (this.zipref = e);\n\n    this.state = {\n      inputURL: null,\n      pdata: props.pdata,\n      dsty: \"border\",\n      inputReady: false,\n      petsReady: false,\n      petsFound: false,\n      nmatched: 20,\n    };\n  }\n\n  imgUploaded = (e) => {\n    this.setState({ inputURL: URL.createObjectURL(e.target.files[0]) });\n  };\n\n  handleLoad = async (e) => {\n    var input_emb = await this.model.predict(e.target);\n    this.emb = input_emb;\n    this.inputReady = true;\n    this.setState({ inputReady: true });\n    this.run();\n  };\n\n  handleEmb = (e) => {\n    this.petsReady = true;\n    this.setState({ petsReady: true, pdata: this.parr.arr });\n    this.run();\n  };\n\n  run = async () => {\n    if (!this.petsReady | !this.inputReady) {\n      return;\n    }\n    var op = this.find_distances(this.parr.embs, this.emb);\n\n    var pets_distances = [];\n    for (var i = 0; i < this.refdata.length; i++) {\n      pets_distances.push({\n        dist: await op[i],\n        key: this.refdata[i][\"key\"],\n        name: this.refdata[i][\"name\"],\n        link: this.refdata[i][\"link\"],\n        src: this.refdata[i][\"src\"],\n      });\n    }\n    pets_distances.sort(function (x, y) {\n      return d3.ascending(x.dist, y.dist);\n    });\n    this.setState({ pdata: pets_distances });\n  };\n\n  find_distances = (pets, img_emb) => {\n    var dist_array = [];\n    dist_array = pets.map((el) => this.emb_compares(img_emb, el));\n    return dist_array;\n  };\n\n  emb_compares = async (img_emb, pet_emb) => {\n    var pe = await pet_emb;\n\n    var distance =\n      Math.pow(pe[0] - img_emb[0], 2) +\n      Math.pow(pe[1] - img_emb[1], 2) +\n      Math.pow(pe[2] - img_emb[2], 2) +\n      Math.pow(pe[3] - img_emb[3], 2) +\n      Math.pow(pe[4] - img_emb[4], 2);\n\n    return distance;\n  };\n\n  zipInput = (e) => {\n    console.log(\"zipinput\", this.zipref.value.substr(0, 3));\n    var newdat = this.zipdata.filter((d) => {\n      return d.searchzip.substr(0, 5) === this.zipref.value.substr(0, 5);\n    });\n\n    if (newdat.length === 0) {\n      newdat = this.zipdata.filter((d) => {\n        return d.searchzip.substr(0, 4) === this.zipref.value.substr(0, 4);\n      });\n    }\n\n    if (newdat.length === 0) {\n      newdat = this.zipdata.filter((d) => {\n        return d.searchzip.substr(0, 3) === this.zipref.value.substr(0, 3);\n      });\n    }\n\n    if (newdat.length === 0) {\n      newdat = this.zipdata.filter((d) => {\n        return d.searchzip.substr(0, 2) === this.zipref.value.substr(0, 2);\n      });\n    }\n\n    if (newdat.length === 0) {\n      newdat = this.zipdata.filter((d) => {\n        return d.searchzip.substr(0, 1) === this.zipref.value.substr(0, 1);\n      });\n    }\n\n    if (newdat.length > 0) {\n      var nmatch = Math.min(20, newdat.length);\n      newdat = this.getRandomSubarray(newdat, nmatch);\n\n      this.refdata = newdat;\n      this.setState({ petsReady: false, petsFound: true, nmatched: nmatch });\n      this.parr = new Parray(newdat, this.handleEmb, this.model);\n    } else {\n      newdat = this.getRandomSubarray(this.zipdata, 20);\n\n      this.refdata = newdat;\n      this.setState({ petsReady: false, petsFound: false, nmatched: 20 });\n      this.parr = new Parray(newdat, this.handleEmb, this.model);\n    }\n  };\n\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <h1 style={{ fontWeight: \"bold\" }}>Face Ventura Pet Detector</h1>\n          Use Facial Recognition to find shelter pets that look like you!\n          <br /> <br /> Upload your photo:{\" \"}\n          <input type=\"file\" onChange={this.imgUploaded} />\n          <br /> Input your zipcode:\n          <span>\n            <input type=\"text\" size=\"6\" maxLength=\"5\" ref={this.zip} />\n            <button onMouseUp={this.zipInput}>Refresh</button>\n          </span>\n          <div>\n            {this.state.petsFound\n              ? \"Found nearby pets! Showing \" +\n                String(this.state.nmatched) +\n                \" pets.\"\n              : \"No nearby pets, showing \" +\n                String(this.state.nmatched) +\n                \" pets in the US.\"}\n          </div>\n          <br />\n          <div className={this.state.petsReady ? \"\" : \"loading\"}>\n            Loading Model and Data {this.state.petsReady ? \"✅\" : \"\"}\n          </div>\n          <br />\n        </header>\n        <div>\n          <span style={{ display: this.state.inputReady ? \"inline\" : \"none\" }}>\n            Matching{\" \"}\n            <img\n              src={this.state.inputURL}\n              alt=\"\"\n              onLoad={this.handleLoad}\n              width=\"15%\"\n            />{\" \"}\n            with pets available for adoption.\n          </span>\n          <div>\n            {this.state.pdata.map((p) => (\n              <PetMatch\n                info={p}\n                inputSRC={this.state.inputURL}\n                petready={this.state.petsReady}\n                inputready={this.state.inputReady}\n              />\n            ))}\n          </div>\n        </div>\n        <br />\n        <br />\n        <footer className=\"App-footer\">\n          Data retrieved from the petfinder.com API.\n        </footer>\n      </div>\n    );\n  }\n\n  //Zip code information from\n  //<a href=\"https://simplemaps.com/data/us-zips\">\n  //  https://simplemaps.com/data/us-zips\n  //</a>\n  //.\n\n  getRandomSubarray(arr, size) {\n    var shuffled = arr.slice(0),\n      i = arr.length,\n      min = i - size,\n      temp,\n      index;\n    while (i-- > min) {\n      index = Math.floor((i + 1) * Math.random());\n      temp = shuffled[index];\n      shuffled[index] = shuffled[i];\n      shuffled[i] = temp;\n    }\n    return shuffled.slice(min);\n  }\n}\n//https://simplemaps.com/data/us-zips\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport \"bootstrap/dist/css/bootstrap.css\";\n\nfunction addKey(e, i) {\n  e.key = i;\n  //e.src = e.src; // + \"?\" + new Date().getTime();\n  e.emb = null;\n  e.dist = NaN;\n  return e;\n}\n\nfunction getRandomSubarray(arr, size) {\n  var shuffled = arr.slice(0),\n    i = arr.length,\n    min = i - size,\n    temp,\n    index;\n  while (i-- > min) {\n    index = Math.floor((i + 1) * Math.random());\n    temp = shuffled[index];\n    shuffled[index] = shuffled[i];\n    shuffled[i] = temp;\n  }\n  return shuffled.slice(min);\n}\n\nvar rawzip = require(\"./data/petfinder_out_zip.json\");\nrawzip = rawzip.map((e, i) => addKey(e, i));\n//var idx = tf.randomUniform([50]).mul(rawzip.length).floor().arraySync();\nvar rawdata = getRandomSubarray(rawzip, 20);\n\n//var rawdata = require(\"./data/petfinder_out.json\");\n//rawdata = rawdata.map((e, i) => addKey(e, i));\n\nReactDOM.render(\n  <React.StrictMode>\n    <App pdata={rawdata} zipdata={rawzip} />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}