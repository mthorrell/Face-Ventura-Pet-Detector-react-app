(this.webpackJsonpbasic=this.webpackJsonpbasic||[]).push([[0],{40:function(e,t,a){e.exports=a(64)},46:function(e,t,a){},47:function(e,t,a){},53:function(e,t){},54:function(e,t){},55:function(e,t){},56:function(e,t){},57:function(e,t){},58:function(e,t){},59:function(e,t,a){},64:function(e,t,a){"use strict";a.r(t);var n=a(3),r=a.n(n),s=a(4),i=a(1),o=a.n(i),c=a(32),u=a.n(c),l=(a(46),a(5)),p=a(6),d=a(20),m=a(19),h=(a(47),a(8)),f=function(){function e(t){var a=this;Object(l.a)(this,e),this.predict=function(){var e=Object(s.a)(r.a.mark((function e(t){var n,s,i,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.model;case 2:return n=e.sent,t.crossOrigin="",(s=document.createElement("canvas")).width=20,s.height=20,s.getContext("2d").drawImage(t,0,0,20,20),i=a.tensor_grayscale(h.a.fromPixels(s)).reshape([1,20,20,1]),o=n.predict(i).arraySync()[0],e.abrupt("return",o);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.model=h.b("model/model.json")}return Object(p.a)(e,[{key:"tensor_grayscale",value:function(e){var t=h.c(.299),a=h.c(.587),n=h.c(.114),r=e.slice([0,0,0],[e.shape[0],e.shape[1],1]),s=e.slice([0,0,1],[e.shape[0],e.shape[1],1]),i=e.slice([0,0,2],[e.shape[0],e.shape[1],1]),o=r.mul(t).add(s.mul(a)).add(i.mul(n));return o=o.mul(h.c(1/255))}}]),e}(),b=function(){function e(t,a,n){var i=this;Object(l.a)(this,e),this.totalLoaded=function(){i.loadedCount=i.loadedCount+1,i.loadedCount===i.arr.length&&(i.embs=i.addEmbs(i.imgs))},this.totalEmb=function(){i.embCount=i.embCount+1,i.embCount===i.arr.length&&i.cback()},this.createImg=function(e){var t=document.createElement("img");return t.crossOrigin="anonymous",t.src=e.src+"?"+(new Date).getTime(),t.onload=i.totalLoaded,t},this.addEmbs=function(e){return e.map((function(e){return i.getEmbs(e)}))},this.getEmbs=function(){var e=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.model.predict(t);case 2:return a=e.sent,i.totalEmb(),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.model=n,this.arr=t,this.loadedCount=0,this.embCount=0,this.imgs=this.addImgs(t),this.embs=[],this.cback=a}return Object(p.a)(e,[{key:"addImgs",value:function(e){var t=this;return e.map((function(e){return t.createImg(e)}))}}]),e}(),v=a(34),y=(a(59),a(66)),g=a(67),E=a(68),w=a(69),z=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).mov=function(){n.setState({mouseOver:!0})},n.mlef=function(){n.setState({mouseOver:!1})},n.dv=void 0,n.mainDiv=function(e){return n.dv=e},n.state={mouseOver:!1},n}return Object(p.a)(a,[{key:"render",value:function(){var e=this.props.info,t=this.props.inputSRC,a=this.props.petready,n=this.props.inputready,r=a&n;return o.a.createElement("div",{className:this.state.mouseOver?"mover":"normal",onMouseOver:this.mov,onMouseLeave:this.mlef,ref:this.mainDiv},o.a.createElement(y.a,{url:"https://mthorrell.github.io/FacePet",style:{position:"absolute",bottom:"5px",right:"5px",display:a&this.state.mouseOver?"":"none"}},o.a.createElement(g.a,{size:32,round:!0})),o.a.createElement(E.a,{url:"https://mthorrell.github.io/FacePet",style:{position:"absolute",bottom:"5px",right:"40px",display:a&this.state.mouseOver?"":"none"}},o.a.createElement(w.a,{size:32,round:!0})),o.a.createElement("h2",{style:{display:a?"":"none"}},String(e.name)),o.a.createElement("span",null,o.a.createElement("img",{className:"inRow",src:t,alt:"",style:{display:n?"inline":"none"}}),o.a.createElement("img",{className:"inRow",alt:a?e.name:"",crossOrigin:"anonymous",src:e.src+"?"+(new Date).getTime(),style:{display:a?"":"none"}})),o.a.createElement("div",null,o.a.createElement("div",null,o.a.createElement("span",{style:{display:r?"inline":"none"}},"Distance: ",e.dist.toFixed(2))),o.a.createElement("span",null,a?o.a.createElement("a",{href:e.link,target:"_blank",rel:"noopener noreferrer"}," ","See more of ",String(e.name)):"LOADING PET")))}}]),a}(i.Component),R=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).imgUploaded=function(e){n.setState({inputURL:URL.createObjectURL(e.target.files[0])})},n.handleLoad=function(){var e=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.model.predict(t.target);case 2:a=e.sent,n.emb=a,n.inputReady=!0,n.setState({inputReady:!0}),n.run();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.handleEmb=function(e){n.petsReady=!0,n.setState({petsReady:!0,pdata:n.parr.arr}),n.run()},n.run=Object(s.a)(r.a.mark((function e(){var t,a,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!n.petsReady|!n.inputReady)){e.next=2;break}return e.abrupt("return");case 2:t=n.find_distances(n.parr.embs,n.emb),a=[],s=0;case 5:if(!(s<n.refdata.length)){e.next=19;break}return e.t0=a,e.next=9,t[s];case 9:e.t1=e.sent,e.t2=n.refdata[s].key,e.t3=n.refdata[s].name,e.t4=n.refdata[s].link,e.t5=n.refdata[s].src,e.t6={dist:e.t1,key:e.t2,name:e.t3,link:e.t4,src:e.t5},e.t0.push.call(e.t0,e.t6);case 16:s++,e.next=5;break;case 19:a.sort((function(e,t){return v.a(e.dist,t.dist)})),n.setState({pdata:a});case 21:case"end":return e.stop()}}),e)}))),n.find_distances=function(e,t){return e.map((function(e){return n.emb_compares(t,e)}))},n.emb_compares=function(){var e=Object(s.a)(r.a.mark((function e(t,a){var n,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a;case 2:return n=e.sent,s=Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2)+Math.pow(n[2]-t[2],2)+Math.pow(n[3]-t[3],2)+Math.pow(n[4]-t[4],2),e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),n.zipInput=function(e){console.log("zipinput",n.zipref.value.substr(0,3));var t=n.zipdata.filter((function(e){return e.searchzip.substr(0,5)===n.zipref.value.substr(0,5)}));if(0===t.length&&(t=n.zipdata.filter((function(e){return e.searchzip.substr(0,4)===n.zipref.value.substr(0,4)}))),0===t.length&&(t=n.zipdata.filter((function(e){return e.searchzip.substr(0,3)===n.zipref.value.substr(0,3)}))),0===t.length&&(t=n.zipdata.filter((function(e){return e.searchzip.substr(0,2)===n.zipref.value.substr(0,2)}))),0===t.length&&(t=n.zipdata.filter((function(e){return e.searchzip.substr(0,1)===n.zipref.value.substr(0,1)}))),t.length>0){var a=Math.min(20,t.length);t=n.getRandomSubarray(t,a),n.refdata=t,n.setState({petsReady:!1,petsFound:!0,nmatched:a}),n.parr=new b(t,n.handleEmb,n.model)}else t=n.getRandomSubarray(n.zipdata,20),n.refdata=t,n.setState({petsReady:!1,petsFound:!1,nmatched:20}),n.parr=new b(t,n.handleEmb,n.model)},n.emb=null,n.inputReady=!1,n.petsReady=!1,n.model=new f,n.parr=new b(e.pdata,n.handleEmb,n.model),n.refdata=e.pdata,n.zipdata=e.zipdata,n.zipref=void 0,n.zip=function(e){return n.zipref=e},n.state={inputURL:null,pdata:e.pdata,dsty:"border",inputReady:!1,petsReady:!1,petsFound:!1,nmatched:20},n}return Object(p.a)(a,[{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"App"},o.a.createElement("header",{className:"App-header"},o.a.createElement("h1",{style:{fontWeight:"bold"}},"Face Ventura Pet Detector"),"Use Facial Recognition to find shelter pets that look like you!",o.a.createElement("br",null)," ",o.a.createElement("br",null)," Upload your photo:"," ",o.a.createElement("input",{type:"file",onChange:this.imgUploaded}),o.a.createElement("br",null)," Input your zipcode:",o.a.createElement("span",null,o.a.createElement("input",{type:"text",size:"6",maxLength:"5",ref:this.zip}),o.a.createElement("button",{onMouseUp:this.zipInput},"Refresh")),o.a.createElement("div",null,this.state.petsFound?"Found nearby pets! Showing "+String(this.state.nmatched)+" pets.":"No nearby pets, showing "+String(this.state.nmatched)+" pets in the US."),o.a.createElement("br",null),o.a.createElement("div",{className:this.state.petsReady?"":"loading"},"Loading Model and Data ",this.state.petsReady?"\u2705":""),o.a.createElement("br",null)),o.a.createElement("div",null,o.a.createElement("span",{style:{display:this.state.inputReady?"inline":"none"}},"Matching"," ",o.a.createElement("img",{src:this.state.inputURL,alt:"",onLoad:this.handleLoad,width:"15%"})," ","with pets available for adoption."),o.a.createElement("div",null,this.state.pdata.map((function(t){return o.a.createElement(z,{info:t,inputSRC:e.state.inputURL,petready:e.state.petsReady,inputready:e.state.inputReady})})))),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("footer",{className:"App-footer"},"Data retrieved from the petfinder.com API."))}},{key:"getRandomSubarray",value:function(e,t){for(var a,n,r=e.slice(0),s=e.length,i=s-t;s-- >i;)a=r[n=Math.floor((s+1)*Math.random())],r[n]=r[s],r[s]=a;return r.slice(i)}}]),a}(i.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(63);function O(e,t){return e.key=t,e.emb=null,e.dist=NaN,e}function k(e,t){for(var a,n,r=e.slice(0),s=e.length,i=s-t;s-- >i;)a=r[n=Math.floor((s+1)*Math.random())],r[n]=r[s],r[s]=a;return r.slice(i)}function x(){return(x=Object(s.a)(r.a.mark((function e(){var t,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://facepet.s3.amazonaws.com/pet_data.json",e.next=3,fetch("https://facepet.s3.amazonaws.com/pet_data.json").then((function(e){return e.json()}));case 3:t=(t=e.sent).map((function(e,t){return O(e,t)})),a=k(t,20),u.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(R,{pdata:a,zipdata:t})),document.getElementById("root"));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){x.apply(this,arguments)}(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[40,1,2]]]);
//# sourceMappingURL=main.007e1051.chunk.js.map